<!DOCTYPE html>
<meta charset="utf-8">
<html>
  <head>
    <style>
      rect.bordered {
        stroke: #E6E6E6;
        stroke-width:2px;   
      }

    </style>
    <script src="http://d3js.org/d3.v3.js"></script>
    <script src="d3-tip.js"></script>
  </head>
  <body>
    <div id="chart"></div>

    <script type="text/javascript">
      var margin = { top: 50, right: 0, bottom: 100, left: 30 };
      var width = 960 - margin.left - margin.right;
      var height = 430 - margin.top - margin.bottom;
      var gridSize = Math.floor(width / 24);
      var legendElementWidth = gridSize*2;
      var buckets = 9;
      var colors = ["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"];
      
      
      var search_data = [
        {
          url: "",
          personal: [
            {"result":"HELLO! Online: celebrity & royal news, magazine, babies ...","url":"http://www.hellomagazine.com/"},
            {"result":"Hello on Vimeo","url":"http://vimeo.com/35055590"},
            {"result":"Martin Solveig & Dragonette - Hello (Official Short Video ...","url":"http://www.youtube.com/watch?v=kK42LZqO0wA"},
            {"result":"Lionel Richie - Hello - YouTube","url":"http://www.youtube.com/watch?v=PDZcqBgCS74"},
            {"result":"hello sms - Android Apps on Google Play","url":"https://play.google.com/store/apps/details?id=com.hellotext.hello"},
            {"result":"HELLO! (hellomag) on Twitter","url":"https://twitter.com/hellomag"},
            {"result":"#Ruby on #Rails crew! Who's going to @railsconf? Come ...","url":"https://plus.google.com/105075583437166504731/posts/6gtrTMMcgN2"}
          ],
          
          anonymous: [
            {"result":"HELLO! Online: celebrity & royal news, magazine, babies, weddings ...","url":"/url?q=http://www.hellomagazine.com/&sa=U&ei=_v1gU7WwDfDH7AbBxIHQDQ&ved=0CB8QFjAA&usg=AFQjCNEIuvxOruVb8gnn1d8rijxNsx_Dbw"},
            {"result":"Hello on Vimeo","url":"/url?q=http://vimeo.com/35055590&sa=U&ei=_v1gU7WwDfDH7AbBxIHQDQ&ved=0CCwQtwIwAw&usg=AFQjCNGJTy7SIaRGipQoO7Kq2B8lzhP4Gg"},
            {"result":"Lionel Richie - Hello - YouTube","url":"/url?q=http://www.youtube.com/watch%3Fv%3DPDZcqBgCS74&sa=U&ei=_v1gU7WwDfDH7AbBxIHQDQ&ved=0CDEQtwIwBA&usg=AFQjCNEMLEMOVccSFaPqiP3PPLbX1WU5PA"},
            {"result":"Martin Solveig & Dragonette - Hello (Official Short Video Version HD ...","url":"/url?q=http://www.youtube.com/watch%3Fv%3DkK42LZqO0wA&sa=U&ei=_v1gU7WwDfDH7AbBxIHQDQ&ved=0CDYQtwIwBQ&usg=AFQjCNFpemQL8FNoaToHwH-LN_WnWinLnQ"},
            {"result":"Evernote Hello | Evernote","url":"/url?q=http://evernote.com/hello/&sa=U&ei=_v1gU7WwDfDH7AbBxIHQDQ&ved=0CDoQFjAG&usg=AFQjCNE8meS-MhObAg-SmAYtGBNAcUudUw"},
            {"result":"Hello - Wikipedia, the free encyclopedia","url":"/url?q=http://en.wikipedia.org/wiki/Hello&sa=U&ei=_v1gU7WwDfDH7AbBxIHQDQ&ved=0CEAQFjAH&usg=AFQjCNGnbyFSUm4hiaTJNYwY8o817AEt9g"},
            {"result":"HELLO! | Facebook","url":"/url?q=https://www.facebook.com/hello&sa=U&ei=_v1gU7WwDfDH7AbBxIHQDQ&ved=0CEYQFjAI&usg=AFQjCNHNW23YZ_DWFAZE3bhGCX4OFmeRXQ"}
          ]
        },
        {
          url: "",
          personal: [
            {"result":"Ruby Programming Language","url":"https://www.ruby-lang.org/"},
            {"result":"Ruby on Rails","url":"http://rubyonrails.org/"},
            {"result":"Ruby (programming language) - Wikipedia, the free ...","url":"http://en.wikipedia.org/wiki/Ruby_(programming_language)"},
            {"result":"Ruby - Wikipedia, the free encyclopedia","url":"http://en.wikipedia.org/wiki/Ruby"},
            {"result":"Kaiser Chiefs - Ruby - YouTube","url":"http://www.youtube.com/watch?v=qObzgUfCl28"},
            {"result":"Ruby-Doc.org: Documenting the Ruby Language","url":"http://ruby-doc.org/"},
            {"result":"Ruby | Codecademy","url":"http://www.codecademy.com/tracks/ruby"},
            {"result":"Don't get frustrated with #Ruby on #Rails, our tutor +Naomi ...","url":"https://plus.google.com/105075583437166504731/posts/X4CDZjr53r4"},
            {"result":"RubyInstaller for Windows","url":"http://rubyinstaller.org/"},
            {"result":"Learn Ruby with the Neo Ruby Koans","url":"http://rubykoans.com/"}
          ],
          anonymous: [
            {"result":"Ruby Programming Language","url":"/url?q=https://www.ruby-lang.org/&sa=U&ei=mP5gU8-xGM_G7AaQqoG4Bg&ved=0CB4QFjAA&usg=AFQjCNE0NraurcYjKI_Tk25kkl6wDqj9WQ"},
            {"result":"Ruby (programming language) - Wikipedia, the free encyclopedia","url":"/url?q=http://en.wikipedia.org/wiki/Ruby_(programming_language)&sa=U&ei=mP5gU8-xGM_G7AaQqoG4Bg&ved=0CCkQFjAB&usg=AFQjCNF-iQZAdmqKtJqHqNCPP28PoeGo0Q"},
            {"result":"Ruby - Wikipedia, the free encyclopedia","url":"/url?q=http://en.wikipedia.org/wiki/Ruby&sa=U&ei=mP5gU8-xGM_G7AaQqoG4Bg&ved=0CDQQFjAC&usg=AFQjCNEVBOgDi8yoFXdDRqv65mEJEV65kQ"},
            {"result":"Ruby on Rails","url":"/url?q=http://rubyonrails.org/&sa=U&ei=mP5gU8-xGM_G7AaQqoG4Bg&ved=0CD4QFjAD&usg=AFQjCNGE-QkhRVkeGxeT6lpOODxG3ylZJQ"},
            {"result":"Images for ruby","url":"/images?q=ruby&hl=en&sa=X&oi=image_result_group&ei=mP5gU8-xGM_G7AaQqoG4Bg&ved=0CEQQsAQ"},
            {"result":"Kaiser Chiefs - Ruby - YouTube","url":"/url?q=http://www.youtube.com/watch%3Fv%3DqObzgUfCl28&sa=U&ei=mP5gU8-xGM_G7AaQqoG4Bg&ved=0CFEQtwIwCQ&usg=AFQjCNGZAEg8tLQ5MD0SpW8f2j6nuhg6xQ"},
            {"result":"Ruby-Doc.org: Documenting the Ruby Language","url":"/url?q=http://ruby-doc.org/&sa=U&ei=mP5gU8-xGM_G7AaQqoG4Bg&ved=0CFUQFjAK&usg=AFQjCNGbG4DHL0bwDHGXiT5R7ItLYh4G6g"},
            {"result":"Ruby | Codecademy","url":"/url?q=http://www.codecademy.com/tracks/ruby&sa=U&ei=mP5gU8-xGM_G7AaQqoG4Bg&ved=0CFsQFjAL&usg=AFQjCNGA4kVwwgz780DJ-UkfawI-9DTlbw"},
            {"result":"RubyInstaller for Windows","url":"/url?q=http://rubyinstaller.org/&sa=U&ei=mP5gU8-xGM_G7AaQqoG4Bg&ved=0CGEQFjAM&usg=AFQjCNG32RsPouBaBJ-HxgRkzpk-Wu_F4g"},
            {"result":"Downloads - RubyInstaller","url":"/url?q=http://rubyinstaller.org/downloads/&sa=U&ei=mP5gU8-xGM_G7AaQqoG4Bg&ved=0CGcQFjAN&usg=AFQjCNGVWhAEKHrp8EN6P7J60tTstuIiAQ"},
            {"result":"Learn Ruby with the Neo Ruby Koans","url":"/url?q=http://rubykoans.com/&sa=U&ei=mP5gU8-xGM_G7AaQqoG4Bg&ved=0CG0QFjAO&usg=AFQjCNELYFSFy70_bVEFn8sLmYP_voetLw"}
          ] 
        },
        {
       		url: "",
          personal: [
            {"result":"Typography - Wikipedia, the free encyclopedia","url":"http://en.wikipedia.org/wiki/Typography"},
            {"result":"I love Typography","url":"http://ilovetypography.com/"},
            {"result":"Hoefler & Co.","url":"http://www.typography.com/"},
            {"result":"Typography projects on Behance","url":"http://www.behance.net/search?field=97"},
            {"result":"Typography Served :: Gallery","url":"http://www.typographyserved.com/"},
            {"result":"typography on Tumblr","url":"http://www.tumblr.com/tagged/TYPOGRAPHY"},
            {"result":"Butterick's Practical Typography","url":"http://practicaltypography.com/"},
            {"result":"We Love Typography","url":"http://welovetypography.com/"},
            {"result":"Typography on Pinterest","url":"http://www.pinterest.com/dschwen/typography/"},
            {"result":"Microsoft Typography - Free font information, TrueType ...","url":"http://www.microsoft.com/typography/"}
          ],
          
          anonymous: [
            {"result":"Typography - Wikipedia, the free encyclopedia","url":"/url?q=http://en.wikipedia.org/wiki/Typography&sa=U&ei=lABhU4uHBKaw7Aa_joD4Ag&ved=0CB4QFjAA&usg=AFQjCNHNd_aDh_LLsUIDDq2VtDHuZL-dhA"},
            {"result":"fonts, typefaces and all things typographical  I love Typography (ILT)","url":"/url?q=http://ilovetypography.com/&sa=U&ei=lABhU4uHBKaw7Aa_joD4Ag&ved=0CCkQFjAB&usg=AFQjCNFOEU81pASNTYYuj-kN71VRIMNjPg"},
            {"result":"Images for typography","url":"/images?q=typography&aqs=chrome.0.69i59j69i61j0l4.1223j0j7&es_sm=91&hl=en&sa=X&oi=image_result_group&ei=lABhU4uHBKaw7Aa_joD4Ag&ved=0CDQQsAQ"},
            {"result":"Typography Served :: Gallery","url":"/url?q=http://www.typographyserved.com/&sa=U&ei=lABhU4uHBKaw7Aa_joD4Ag&ved=0CEIQFjAI&usg=AFQjCNEx6-VQKcjPWhrA_-q4jVrBio6jDw"},
            {"result":"Hoefler & Co.","url":"/url?q=http://www.typography.com/&sa=U&ei=lABhU4uHBKaw7Aa_joD4Ag&ved=0CEgQFjAJ&usg=AFQjCNHuhXpmQz5yFTd5l2O9vp8s6UAUew"},
            {"result":"Butterick's Practical Typography","url":"/url?q=http://practicaltypography.com/&sa=U&ei=lABhU4uHBKaw7Aa_joD4Ag&ved=0CE4QFjAK&usg=AFQjCNEc3u9hK3AcQFEQSz-fmB4pjDfaaw"},
            {"result":"Typography projects on Behance","url":"/url?q=http://www.behance.net/search%3Ffield%3D97&sa=U&ei=lABhU4uHBKaw7Aa_joD4Ag&ved=0CFQQFjAL&usg=AFQjCNEeQC0fdIVJIASSUPhKKA__oGvAIg"},
            {"result":"We Love Typography","url":"/url?q=http://welovetypography.com/&sa=U&ei=lABhU4uHBKaw7Aa_joD4Ag&ved=0CFoQFjAM&usg=AFQjCNHaBSN0RJcRb23QuW8CaX6suPqOZg"},
            {"result":"Microsoft Typography - Free font information, TrueType, OpenType ...","url":"/url?q=http://www.microsoft.com/typography/&sa=U&ei=lABhU4uHBKaw7Aa_joD4Ag&ved=0CGAQFjAN&usg=AFQjCNGkPVP0k5PlGUw5_0BFVSwndL3HfQ"},
            {"result":"A lesson on typography - YouTube","url":"/url?q=http://www.youtube.com/watch%3Fv%3DKi6rcXvUWP0&sa=U&ei=lABhU4uHBKaw7Aa_joD4Ag&ved=0CGcQtwIwDg&usg=AFQjCNHmtyZzo6x_pFZHhrIek8Kfw5P1Pw"},
            {"result":"typography on Tumblr","url":"/url?q=http://www.tumblr.com/tagged/TYPOGRAPHY&sa=U&ei=lABhU4uHBKaw7Aa_joD4Ag&ved=0CGsQFjAP&usg=AFQjCNEFR7iHNVy_KN48R2yLwfEgVZNGjQ"}
          ],
          personal: [
          	{"result":"Din | Define Din at Dictionary.com","url":"http://dictionary.reference.com/browse/din"},
          	{"result":"Deutsches Institut für Normung - Wikipedia, the free ...","url":"http://en.wikipedia.org/wiki/Deutsches_Institut_f%C3%BCr_Normung"},
          	{"result":"Deutsches Institut für Normung : Homepage EN","url":"http://www.din.de/cmd?level=tpl-home&languageid=en"},
          	{"result":"Din - Merriam-Webster Online","url":"http://www.merriam-webster.com/dictionary/din"},
          	{"result":"FF DIN® - Desktop font « MyFonts","url":"http://www.myfonts.com/fonts/fontfont/ff-din/"},
          	{"result":"din - definition of din by the Free Online Dictionary ...","url":"http://www.thefreedictionary.com/din"},
          	{"result":"Germany (DIN) - ISO","url":"http://www.iso.org/iso/about/iso_members/iso_member_body.htm?member_id=1511"},
          	{"result":"DiN","url":"http://www.din.org.uk/"},{"result":"DIN Is Noise","url":"http://dinisnoise.org/"},
          	{"result":"din - Wiktionary","url":"http://en.wiktionary.org/wiki/din"}
          ], 
          anonymous: [
          	{"result":"Din | Define Din at Dictionary.com","url":"/url?q=http://dictionary.reference.com/browse/din&sa=U&ei=MAJhU7_qOrDo7AbehYCoCQ&ved=0CB4QFjAA&usg=AFQjCNEl-MEcCU7Bff1UWdTRLu6ViwpWfQ"},
          	{"result":"Deutsches Institut für Normung - Wikipedia, the free encyclopedia","url":"/url?q=http://en.wikipedia.org/wiki/Deutsches_Institut_f%25C3%25BCr_Normung&sa=U&e…AJhU7_qOrDo7AbehYCoCQ&ved=0CCQQFjAB&usg=AFQjCNH6Kx_1zB-Oj81cvQNBykKM9Izi7w"},
          	{"result":"DIN connector - Wikipedia, the free encyclopedia","url":"/url?q=http://en.wikipedia.org/wiki/DIN_connector&sa=U&ei=MAJhU7_qOrDo7AbehYCoCQ&ved=0CC8QFjAC&usg=AFQjCNFWFps-HfvYsFv18iwQDiHCRuOzwA"},
          	{"result":"Deutsches Institut für Normung : Homepage EN","url":"/url?q=http://www.din.de/cmd%3Flevel%3Dtpl-home%26languageid%3Den&sa=U&ei=MAJhU7_qOrDo7AbehYCoCQ&ved=0CDoQFjAD&usg=AFQjCNHGkIrhTcbvl3lHmc39166z4cXl8w"},
          	{"result":"Din - Definition and More from the Free Merriam-Webster Dictionary","url":"/url?q=http://www.merriam-webster.com/dictionary/din&sa=U&ei=MAJhU7_qOrDo7AbehYCoCQ&ved=0CEAQFjAE&usg=AFQjCNEiziVk0IQw5lgnWTHPrnyByiybsA"},
          	{"result":"Germany (DIN) - ISO","url":"/url?q=http://www.iso.org/iso/about/iso_members/iso_member_body.htm%3Fmember_id%3D…AJhU7_qOrDo7AbehYCoCQ&ved=0CEYQFjAF&usg=AFQjCNEsWGKA-Nv6fnrqSby75h_Ve9sJKA"},
          	{"result":"din - definition of din by the Free Online Dictionary, Thesaurus and ...","url":"/url?q=http://www.thefreedictionary.com/din&sa=U&ei=MAJhU7_qOrDo7AbehYCoCQ&ved=0CEwQFjAG&usg=AFQjCNGjulZaPjxZ-3-MLalMNaMqzHJAAA"},
          	{"result":"Images for din","url":"/images?q=din&aqs=chrome.0.69i59j0l5.486j0j7&es_sm=91&hl=en&sa=X&oi=image_result_group&ei=MAJhU7_qOrDo7AbehYCoCQ&ved=0CFIQsAQ"},
          	{"result":"DiN","url":"/url?q=http://www.din.org.uk/&sa=U&ei=MAJhU7_qOrDo7AbehYCoCQ&ved=0CF4QFjAM&usg=AFQjCNEQR-ygHNNrBJOP5PK1Td-4eJCB_w"},
          	{"result":"DIN Is Noise","url":"/url?q=http://dinisnoise.org/&sa=U&ei=MAJhU7_qOrDo7AbehYCoCQ&ved=0CGQQFjAN&usg=AFQjCNHIp1rHuJVuTlQ_zTnQFQRtO3B5Ig"},
          	{"result":"din - Wiktionary","url":"/url?q=http://en.wiktionary.org/wiki/din&sa=U&ei=MAJhU7_qOrDo7AbehYCoCQ&ved=0CGoQFjAO&usg=AFQjCNENbSVzySxkJAuMFiJWbVxqrsYfvA"}
          ] 
        }
        /* ... */
      ];
      
      function getParameterByName(query_string, name) {
         	
    		name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    		var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        	results = regex.exec(query_string);
    		return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	}
      
      var anonymous_url_to_canonical_url = function(anonymous_url){
        var query_string = anonymous_url.slice(4,anonymous_url.length);
        return getParameterByName(query_string, 'q');
      };
      
      var results_to_scores = function(results){
        var scores = [
          /*
          {result: "", category: "both"|"anonymous"|"personal", score: 0.654},
          */
        ];
        
        var personal_results_index = {};
        
        results.personal.forEach(function(result, i){
        	result.personal_rank = i+1;
        	personal_results_index[result.url] = result;
        });
        
        results.anonymous.forEach(function(result, i){
        	var anonymous_rank = i+1;
          	var name = result.result;
          	var canonical_url = anonymous_url_to_canonical_url(result.url);
          
          	if (canonical_url in personal_results_index){
              scores.push({
                url: canonical_url,
                result: personal_results_index[canonical_url].result,
                category: "both",
                personal_rank: personal_results_index[canonical_url].personal_rank,
                anonymous_rank: anonymous_rank,
                score: anonymous_rank - personal_results_index[canonical_url].personal_rank 
              });
              
              delete personal_results_index[canonical_url];
              
            }else{
              scores.push({
                result:name,
                url: canonical_url,
                anonymous_rank: anonymous_rank,
                category: "anonymous"
              }); 
            }
        });
        
        for(var url in personal_results_index){
          scores.push({
            url: url,
            result: personal_results_index[url].result,
            personal_rank: personal_results_index[url].personal_rank,
            category: "personal"
          }); 
        }
        
        return scores;
      };
      
      var data = search_data.map(results_to_scores);
      

      var do_viz = function(data) {
          var colorScale = d3.scale.quantile()
              .domain([0, buckets - 1, d3.max(data, function (d) { return d.score; })])
              .range(colors);

        var tip = d3.tip().attr('class', 'd3-tip').html(function(d) { 
          return d.result; 
        });

        
          var svg = d3.select("#chart").append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
              .append("g")
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
			  .call(tip);

          var heatMap = svg.selectAll(".result")
              .data(data)
              .enter().append("rect")
              .attr("x", function(d, i) { return (i%10) * gridSize; })
              .attr("y", function(d, i) { return Math.floor(i/10) * gridSize; })
              .attr("rx", 4)
              .attr("ry", 4)
              .attr("class", "hour bordered")
              .attr("width", gridSize)
              .attr("height", gridSize)
          	  .style("fill", function(d){
                if(d.category == "anonymous"){ return "#ff0000"; }
                else if(d.category == "personal"){ return "#00ff00"; }
                  else if(d.category == "both"){ return "#0000ff" }
          	   })
              .on('mouseover', tip.show)
              .on('mouseout', tip.hide)
          .on('click', function(d){
          	window.open(d.url);
          });

        /*
        	heatMap.transition().duration(1000)
              .style("fill", function(d) { return colorScale(d.value); });
         */

        
        
          heatMap.append("title").text(function(d) { return d.value; });
              
          var legend = svg.selectAll(".legend")
              .data([0].concat(colorScale.quantiles()), function(d) { return d; })
              .enter().append("g")
              .attr("class", "legend");

          legend.append("rect")
            .attr("x", function(d, i) { return legendElementWidth * i; })
            .attr("y", height)
            .attr("width", legendElementWidth)
            .attr("height", gridSize / 2)
            .style("fill", function(d, i) { return colors[i]; });

          legend.append("text")
            .attr("class", "mono")
            .text(function(d) { return "≥ " + Math.round(d); })
            .attr("x", function(d, i) { return legendElementWidth * i; })
            .attr("y", height + gridSize);
      }
      
      var flattened_data = []
      do_viz(flattened_data.concat.apply(flattened_data, data));
      
    </script>
  </body>
</html>